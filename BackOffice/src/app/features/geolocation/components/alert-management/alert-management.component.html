<div class="alert-management-container">
    <!-- Navigation Tabs -->
    <nav mat-tab-nav-bar class="nav-tabs">
        <a mat-tab-link routerLink="/geolocation/zones" routerLinkActive #rla1="routerLinkActive"
            [active]="rla1.isActive">
            Zones Géographiques
        </a>
        <a mat-tab-link routerLink="/geolocation/alerts" routerLinkActive #rla2="routerLinkActive"
            [active]="rla2.isActive">
            Alertes
        </a>
        <a mat-tab-link routerLink="/geolocation/statistics" routerLinkActive #rla3="routerLinkActive"
            [active]="rla3.isActive">
            Statistiques
        </a>
    </nav>

    <mat-tab-group>
        <!-- Alerts Tab -->
        <mat-tab label="Historique des Alertes">
            <div class="tab-content">
                <div class="header">
                    <h2>Gestion des Alertes Géographiques</h2>
                </div>

                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Rechercher une alerte</mat-label>
                    <input matInput (keyup)="applyFilter($event)" placeholder="Patient, zone...">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

                <div class="table-container">
                    <table mat-table [dataSource]="dataSource" matSort>
                        <ng-container matColumnDef="timestamp">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Date & Heure</th>
                            <td mat-cell *matCellDef="let row">{{row.timestamp | date:'dd/MM/yyyy HH:mm'}}</td>
                        </ng-container>

                        <ng-container matColumnDef="patient">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Patient</th>
                            <td mat-cell *matCellDef="let row">
                                <strong>{{row.patientName}}</strong>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="type">
                            <th mat-header-cell *matHeaderCellDef>Type</th>
                            <td mat-cell *matCellDef="let row">{{getAlertTypeLabel(row.type)}}</td>
                        </ng-container>

                        <ng-container matColumnDef="zone">
                            <th mat-header-cell *matHeaderCellDef>Zone</th>
                            <td mat-cell *matCellDef="let row">{{row.zoneName || '-'}}</td>
                        </ng-container>

                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef>Statut</th>
                            <td mat-cell *matCellDef="let row">
                                <span class="status-badge" [ngClass]="getStatusClass(row.status)">
                                    {{row.status === 'new' ? 'Nouvelle' : row.status === 'in_progress' ? 'En cours' :
                                    row.status === 'resolved' ? 'Résolue' : 'Ignorée'}}
                                </span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>Actions</th>
                            <td mat-cell *matCellDef="let row">
                                <button mat-icon-button (click)="openAlertDetail(row)" matTooltip="Détails">
                                    <mat-icon>visibility</mat-icon>
                                </button>
                                <button mat-icon-button (click)="markAsResolved(row)" *ngIf="row.status !== 'resolved'"
                                    matTooltip="Marquer comme résolue">
                                    <mat-icon>check_circle</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
                </div>
            </div>
        </mat-tab>

        <!-- Settings Tab -->
        <mat-tab label="Configuration">
            <div class="tab-content" *ngIf="settings">
                <h3>Paramètres des Notifications</h3>

                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Notifications SMS</mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-slide-toggle [(ngModel)]="settings.smsEnabled">Activer les SMS</mat-slide-toggle>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Modèle SMS</mat-label>
                        <textarea matInput [(ngModel)]="settings.smsTemplate" rows="3"></textarea>
                    </mat-form-field>
                </mat-expansion-panel>

                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Notifications Email</mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-slide-toggle [(ngModel)]="settings.emailEnabled">Activer les Emails</mat-slide-toggle>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Sujet</mat-label>
                        <input matInput [(ngModel)]="settings.emailSubject">
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Modèle Email</mat-label>
                        <textarea matInput [(ngModel)]="settings.emailTemplate" rows="5"></textarea>
                    </mat-form-field>
                </mat-expansion-panel>

                <div class="actions">
                    <button mat-raised-button color="primary" (click)="saveSettings()">
                        Enregistrer les Paramètres
                    </button>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>
</div>